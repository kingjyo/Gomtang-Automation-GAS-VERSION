# 🍲 곰탕 자동화 시스템 완벽 가이드

> **"클릭 한 번으로 출고 완료!"** - 간편식 주문부터 이메일 발송까지 모든 것을 자동화

---

## 🎯 이 시스템이 하는 일

매일 반복되는 곰탕 출고 업무를 **완전 자동화**합니다:
- ✅ 싸이버스카이에서 주문 데이터 가져오기
- ✅ Gmail에서 EDI 배송정보 자동 추출  
- ✅ 쿠팡 마켓 데이터와 통합
- ✅ 검산으로 실수 방지
- ✅ 품목별 엑셀 파일 자동 생성
- ✅ 담당자들에게 이메일 자동 발송

**결과:** 3시간 걸리던 일을 5분만에! 🚀

---

## 🏃‍♂️ 5분만에 마스터하기

### 1️⃣ 처음 사용자 - 필수 설정

**STEP 1: 권한 승인**
1. 스프레드시트 열기
2. 상단 메뉴 `🤖 곰탕 자동화` 클릭
3. 처음 클릭하면 권한 요청 → `승인` 클릭
4. Google 계정으로 로그인 → `허용` 클릭

**STEP 2: 기본 설정**
1. `🤖 곰탕 자동화` → `⚙️ 설정 및 도구` → `설정`
2. 필수 정보 입력:
   ```
   📁 소스 스프레드시트 ID: [싸이버스카이 원본 시트 ID]
   📂 Drive 폴더 ID: [파일 저장할 폴더 ID] 
   📮 발송지 우편번호: 7505
   🏠 발송지 주소: 서울 강서구 오정로 602
   👤 이메일 발신자 이름: 김영준
   💼 이메일 발신자 직급: 사원
   ✍️ 이메일 서명: 김영준
   ```
3. `💾 저장` 클릭

**STEP 3: 이메일 수신자 설정**
1. 스프레드시트에 `이메일_설정` 시트 만들기
2. 다음 형식으로 작성:
   ```
   | 이메일 | 이름 | 우선순위 | 전송여부 |
   |--------|------|----------|----------|
   | abc@company.com | 홍길동 | 1 | TRUE |
   | def@company.com | 김철수 | 2 | TRUE |
   ```

### 2️⃣ 일반 사용자 - 매일 업무

**🎯 가장 쉬운 방법: 원클릭 실행**

1. `🤖 곰탕 자동화` 클릭
2. `🚀 전체 파이프라인 즉시 실행` 선택  
3. ☕ 커피 한 잔 마시며 대기 (약 2-3분)
4. 🛍️ 쿠팡 업로더 창이 열리면:
   - 쿠팡 파일이 있으면 → 드래그&드롭으로 업로드
   - 쿠팡 파일이 없으면 → `쿠팡 파일 없이 계속` 클릭
5. ✉️ 완료! 담당자들에게 이메일 자동 발송

**🤖 더 편한 방법: 자동화 설정**

1. `🤖 곰탕 자동화` → `⏰ 트리거 및 스케줄링` → `트리거 설정`
2. `📅 전체 자동화 트리거 설정` 선택
3. 매일 오후 2시에 자동 실행! (쿠팡 없어도 OK)

---

## 📋 메뉴별 상세 기능

### 🏠 메인 메뉴

**🚀 전체 파이프라인 즉시 실행**
- 모든 과정을 한 번에 실행 (권장!)
- 싸이버스카이 → EDI → 검산 → 쿠팡 → 이메일까지

**📊 Part 1 실행 (쿠팡 업로드 이전까지)**
- 싸이버스카이, EDI 수집 + 검산까지만
- 쿠팡 데이터는 별도로 처리하고 싶을 때

**🛍️ Part 2 실행 (쿠팡 업로드 이후 과정)**
- 쿠팡 업로드 + 품목별 분할 + 이메일 발송
- Part 1 완료 후 사용

### 📥 데이터 수집

**🏢 싸이버스카이 업데이트**
- 원본 스프레드시트에서 오늘 주문 데이터 가져오기
- `YYYYMMDD_간편식_싸이버스카이` 시트 생성

**📧 오늘 EDI 업데이트**  
- Gmail에서 오늘 EDI 이메일 찾아서 첨부파일 추출
- `YYYYMMDD_간편식_EDI` 시트 생성
- 검색 시간: 오후 1시~3시 30분

**🔄 통합 업데이트**
- 싸이버스카이 + EDI 한번에 수집

### ⚙️ 데이터 처리

**🔧 데이터 처리 실행**
- A시트 + B시트 → C시트 수기송장 생성
- 주요 처리 로직:
  ```
  • B시트 주문번호 '32' 제거 후 매칭
  • 주소 = ADDR1 + ADDR2 결합
  • 수량 조정: A시트 수량 - 1 (B시트 매칭시)
  • 수량 0 이하인 행 제거
  • MEM_ID ≠ 'KAL_CK_MMC'면 ORDER_IDX → GROUP_IDX 이동
  ```

**🧮 검산 실행**
- 데이터 정합성 검증: A시트 = B시트 + C시트
- `YYYYMMDD_검산결과` 시트에 결과 저장
- ❌ 검산 실패시 이메일 알림 발송

**📊 품목별 분할**
- 제품별로 개별 시트 생성:
  - `YYYYMMDD_사골고기곰탕`
  - `YYYYMMDD_사골곰탕` 
  - `YYYYMMDD_육포`

### 🛍️ 쿠팡 연동

**📤 쿠팡 업로더**
- 쿠팡 엑셀 파일(.xlsx) 드래그&드롭 업로드
- 자동으로 Google 시트로 변환
- 수기송장에 쿠팡 데이터 통합 추가

**🔄 무결성 쿠팡 업로더 (고급)**
- 날짜별 자동 트리거와 연동
- 백그라운드에서 안정적 처리

### 📁 파일 및 이메일

**📥 품목별 다운로드**
- 제품별 엑셀 파일 생성 및 Drive 저장
- 파일명: `YYYYMMDD_[제품명]_간편식.xlsx`

**✉️ 이메일 발송**
- 품목별 엑셀 파일을 첨부하여 담당자들에게 발송
- 제목: `MM.DD 간편식 출고요청`
- 내용: 정중한 업무 메일 형식

**📋 로컬 엑셀 업로드**
- PC에 있는 엑셀 파일을 시스템으로 가져오기

### ⏰ 트리거 및 스케줄링

**📅 트리거 설정**
- **전체 자동화**: 매일 오후 2시 완전 자동 실행
- **세미 자동화**: 매일 오후 1시 30분, 검산까지만 실행 후 알림

**📧 수동 완료 자동화**  
- 트리거 실행 중 수동 개입 필요시 완료 처리

### ⚙️ 설정 및 도구

**⚙️ 설정**
- 시스템 전체 설정 관리 (위에서 설명한 설정창)

**📊 구글 피커**
- Google Drive 파일/폴더 선택 도구

**🧹 시트 정리**
- 불필요한 시트들 일괄 삭제

### 🧪 테스트 (개발자용)

- 날짜별 개별 테스트 기능들
- 실제 운영에 영향 없이 안전하게 테스트
- 모든 테스트 시트는 `TEST_` 접두사 사용

---

## 🗂️ 파일 구조 완벽 이해

### 📅 매일 생성되는 시트들

**원본 데이터 (Input)**
```
20250113_간편식_싸이버스카이    ← A시트: 주문 원본
20250113_간편식_EDI           ← B시트: 배송 수량  
20250113_간편식_쿠팡          ← 쿠팡 마켓 데이터
```

**처리된 데이터 (Processing)**
```
20250113_간편식_수기송장       ← C시트: 최종 배송 송장
20250113_검산결과            ← 데이터 검증 결과
```

**제품별 분할 (Output)**
```
20250113_사골고기곰탕         ← 사골고기곰탕만 모음
20250113_사골곰탕           ← 사골곰탕만 모음 
20250113_육포              ← 육포만 모음
```

### 🛠️ 시스템 시트들

**이메일_설정**
- 이메일 수신자 관리
- 컬럼: 이메일, 이름, 우선순위, 전송여부

**업데이트_로그**  
- 자동화 실행 기록 (최근 100개)
- 성공/실패 여부, 실행 시간, 오류 메시지

---

## 🚨 문제해결 가이드

### 😰 자주 발생하는 오류들

**1. "소스 스프레드시트를 찾을 수 없습니다"**
```
해결법:
1. 설정에서 소스 스프레드시트 ID 확인
2. 해당 시트에 접근 권한 확인
3. 시트가 삭제되지 않았는지 확인
```

**2. "Gmail에서 EDI 데이터를 찾을 수 없습니다"**
```
해결법:
1. 오후 1시~3시 30분 사이에 실행했는지 확인
2. Gmail에 EDI 이메일이 실제로 도착했는지 확인
3. 발신자: brdmc@naver.com 또는 suhyang@kas.co.kr 확인
4. 제목에 날짜(MMDD) 포함 여부 확인
```

**3. "검산 실패" 알림**
```
해결법:
1. 검산결과 시트에서 어떤 제품이 불일치인지 확인
2. A시트, B시트, C시트 데이터 수동 확인
3. 필요시 데이터 수동 수정 후 재검산
```

**4. "이메일 발송 실패"**
```
해결법:
1. 이메일_설정 시트 존재 여부 확인
2. 수신자 이메일 주소 유효성 확인
3. Gmail 권한 재승인 필요할 수 있음
```

**5. "쿠팡 파일 업로드 오류"**
```
해결법:
1. .xlsx 또는 .xls 파일인지 확인
2. 파일 크기가 너무 크지 않은지 확인 (10MB 이하)
3. 파일이 손상되지 않았는지 확인
```

### ⚡ 성능 최적화 팁

**🐌 실행이 느릴 때**
- 데이터가 많으면 전체 파이프라인 대신 단계별 실행
- 트리거 사용시 더 안정적임
- 동시에 여러 기능 실행하지 말 것

**💾 메모리 부족 오류**
- 브라우저 새로고침 후 재실행
- 불필요한 시트들 정리
- 오래된 로그 데이터 삭제

**⏰ 시간 초과 오류**  
- Google Apps Script 실행 시간 제한: 6분
- 큰 데이터는 개별 단계로 나누어 실행
- 트리거 사용시 더 관대한 시간 제한

---

## 🎯 실제 업무 시나리오

### 📅 일반적인 하루 업무

**오전 업무**
1. 출근 후 이메일 확인
2. EDI 도착 여부 확인
3. 특별한 이슈 없으면 자동화 대기

**오후 1:30 (세미 자동화 실행시)**
1. 세미 자동화가 검산까지 완료
2. 검산 결과 이메일 확인
3. 문제 없으면 쿠팡 데이터 준비

**오후 2:00 (전체 자동화 실행시)**
1. 자동화가 모든 과정 완료
2. 결과 이메일 확인
3. 담당자들에게 출고 요청 완료!

### 🚨 예외 상황 대응

**EDI가 늦게 도착한 경우**
1. `📧 오늘 EDI 업데이트` 수동 실행
2. 시간 범위를 늘려서 재시도
3. 또는 EDI 없이 먼저 진행

**쿠팡 데이터가 많이 변경된 경우**
1. `🛍️ 쿠팡 업로더`로 새 데이터 업로드
2. `🧮 검산 실행`으로 재검증
3. `📁 품목별 다운로드` 새로 생성

**검산에서 오류 발견한 경우**
1. 검산결과 시트에서 문제 항목 확인
2. 원본 데이터 수동 수정
3. `🧮 검산 실행` 재실행
4. 통과되면 나머지 과정 진행

### 💡 효율성 극대화 꿀팁

**🔥 고수 팁**
- 트리거를 활용하면 완전 무인 자동화 가능!
- 이메일_설정에서 우선순위로 중요도 관리
- 업데이트_로그를 정기적으로 확인해서 문제 조기 발견
- 월말에는 Drive 폴더 정리해서 용량 관리

**⚠️ 주의할 점**
- 중요한 날에는 수동으로 한 번 더 확인
- 연휴 전후에는 EDI 일정 변경 가능성 체크
- 새로운 제품 추가시 제품명 매핑 규칙 확인 필요

---

## 📞 도움이 필요할 때

### 🆘 긴급 상황 대응

**시스템이 완전히 먹통일 때**
1. 브라우저 새로고침 (Ctrl+F5)
2. 다른 브라우저에서 접속
3. Google Apps Script 권한 재승인
4. 마지막 수단: 수동으로 업무 처리

**데이터가 이상할 때**
1. 업데이트_로그 시트에서 마지막 실행 결과 확인
2. 원본 소스 시트에 문제없는지 확인  
3. 검산결과 시트에서 어디서 문제인지 파악

### 📚 추가 학습 자료

**Google Apps Script 기초**
- [공식 문서](https://developers.google.com/apps-script)
- 스크립트 편집기: 확장 프로그램 → Apps Script

**시스템 이해도 높이기**
- `CLAUDE.md` 파일: 개발자용 상세 문서
- 각 기능별 코드 주석 참고
- 실행 로그로 내부 동작 파악

---

## 🎉 마무리

이 시스템으로 **매일 3시간씩 절약**하고, **실수는 0%**에 가깝게 줄일 수 있습니다!

### 🏆 시스템 도입 효과
- ⏱️ **시간 절약**: 3시간 → 5분 (97% 단축!)
- 🎯 **정확도**: 수동 실수 거의 0%
- 😌 **스트레스 감소**: 반복 업무 자동화로 여유 확보
- 📈 **생산성 향상**: 더 중요한 일에 집중 가능

### 🚀 다음 단계 
1. **첫 주**: 기본 기능 익히기
2. **둘째 주**: 트리거 자동화 설정
3. **셋째 주**: 예외 상황 대응법 마스터
4. **넷째 주**: 완전한 곰탕 자동화 전문가! 🎓

---

**🎯 기억하세요**: 이 시스템은 여러분의 업무를 돕기 위해 만들어졌습니다. 궁금한 점이 있으면 언제든지 문의하세요!

**📅 마지막 업데이트**: 2025년 1월  
**🛠️ 시스템 버전**: v2.0  
**📧 문의**: 시스템 관리자